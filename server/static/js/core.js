var Settings={Core:{templates:"/static/templates/",runs:0,poll:60},Paging:{perPage:10}},Core=Class.$extend({__include__:[Settings.Core],__classvars__:{repo:"/repo.json",reply:"",json:"",polls:0,timer:null,views:null,pubsub:!1,runs:0,page:0},__init__:function(){var c=this;Settings.Core.runs<1&&(this.$route("/",function(){c.$class.page=0;c.setView(new Home);$(".s").keypress(function(a){console.log(a);if(a.which==13){var b=unescape($(this).val());b&&!b.isEmpty()&&c.$navigate("/search",b,!0);a.preventDefault();
return!1}return!0})}),this.$route("/page/:page",function(a){c.setView(new Home(a));$(".s").keypress(function(b){console.log(b);if(b.which==13){var a=unescape($(this).val());a&&!a.isEmpty()&&c.$navigate("/search",a,!0);b.preventDefault();return!1}return!0})}),this.$route("/search/:query",function(a){c.setView(new Search(a));$(".s").keypress(function(b){console.log(b);if(b.which==13){var a=unescape($(this).val());a&&!a.isEmpty()&&c.$navigate("/search",a,!0);b.preventDefault();return!1}return!0})}),
this.$route("/category/:query",function(a){c.setView(new Organize(a));$(".s").keypress(function(b){console.log(b);if(b.which==13){var a=unescape($(this).val());a&&!a.isEmpty()&&c.$navigate("/search",a,!0);b.preventDefault();return!1}return!0})}),this.$route("/package/:pack",function(a){c.setView(new Package(a))}),this.$route("/package/:pack/:version",function(a,b){c.setView(new Package(a,b))}));this.$class.views=new Template;this.pollRepo();if(Settings.Core.runs<1)this.$class.timer=(new Timer).interval(6E4),
this.$class.timer.addCallback(this.pollRepo,this.poll),this.$class.timer.start(),Route.setup();Settings.Core.runs++},register:function(c,a){this.$class[c]=a},setView:function(c){this.$class.pubsub=!0;publish("/view",[c])},pollRepo:function(){var c=this.$json(this.$class.repo);this.$class.reply=new Packages(c);this.$class.json={packages:c};this.$class.polls++}}),Finder=Core.$extend({__include__:[Settings.Paging],open:function(){},check:function(){this.$class.reply||alert("[Error] Reply from repo was empty.")}}),
Organize=Core.$extend({__include__:[Settings.Paging],__init__:function(c){this.$super(this);if(c){this.packs={};this.packs.packages=[];var a=this.packs.packages,b=0,e;for(e in this.$class.json.packages){var d=this.$class.json.packages[e];e.equalsIgnoreCase("contains")||(this.ctag(d.categories,c)&&(a[b]=d),b++)}this.packs.packages=a}},open:function(){this.$class.views.path(Settings.Core.templates+"packages.ms").html(".package-list").args(this.packs).parse();$(".package-list").show()},close:function(){$(".package-list").hide()},
ctag:function(c,a){if(c.length<1)return!1;if(c.contains(a)||c.contains(a.toLowerCase()))return!0;for(var b=[],e=[],d="",f=0;f<c.length;f++){d=c[f].trim();d.equals("ADMIN")&&(d="ADMN");if(d.equalsIgnoreCase(a)||d.equals(a))return!0;d.contains("/")?b=d.split("/"):d.contains("-")&&(b=d.split("-"));b.length<1&&(b=[d]);a.contains(",")&&(e=a.split(","));e.length<1&&(e=[a]);for(var h=0;h<e.length;h++){var i=e[h];if(d.equalsIgnoreCase(i)||d.equals(i))return!0;if(b.contains(i)||b.contains(i.toLowerCase()))return!0}}return!1}}),
Search=Core.$extend({__include__:[Settings.Paging],__init__:function(c){this.$super(this);if(c){this.packs={};this.packs.packages=[];var a=this.packs.packages,b=0,e;for(e in this.$class.json.packages){var d=this.$class.json.packages[e];e!="contains"&&(d.name.equals(c)&&(a[b]=d),d.name.equalsIgnoreCase(c)&&(a[b]=d),d.name.search(RegExp(c,"gi"))!=-1&&(a[b]=d),d.description.search(RegExp(c,"gi"))!=-1&&(a[b]=d),this.ctag(d.categories,c)&&(a[b]=d),b++)}this.packs.packages=a}},open:function(){this.$class.views.path(Settings.Core.templates+
"packages.ms").html(".package-list").args(this.packs).parse();$(".package-list").show()},close:function(){$(".package-list").hide()},ctag:function(c,a){if(c.length<1)return!1;if(c.contains(a))return!0;if(c.contains(a.toLowerCase()))return!0;for(var b=[],b="",e=0;e<c.length;e++){b=c[e];b.trim();b.equals("ADMIN")&&(b="ADMN");if(b.equalsIgnoreCase(a)||b.equals(a))return!0;if(b.contains("/")){if(b=b.split("/"),b.contains(a)||b.contains(a.toLowerCase()))return!0}else if(b.contains("-")){if(b=b.split("-"),
b.contains(a)||b.contains(a.toLowerCase()))return!0}else if(b.contains(" ")&&(b=b.split(" "),b.contains(a)||b.contains(a.toLowerCase())))return!0}return!1}}),Home=Core.$extend({__include__:[Settings.Paging],__init__:function(c){this.$super(this);this.page=c===void 0?0:isNaN(c)?0:c},open:function(){var c={},a=chunk(this.$class.json.packages,this.perPage);if(this.page<0)this.page=0;if(a.length-1<this.page)this.page=a.length-1;c.packages=chunk(this.$class.json.packages,this.perPage)[this.page];c.chunks=
a;c.chunkLength=a.length;c.page=this.page;this.$class.views.path(Settings.Core.templates+"packages.ms").html(".package-list").args(c).parse();$(".desc").each(function(){var a=$(this).text();a.length>80&&$(this).html(a.substring(0,80)+"...")});$(".package-list").show()},close:function(){$(".package-list").hide()}}),Package=Core.$extend({__init__:function(c,a){this.$super(this);if(a)this.version=a.replace(/\./g,"_");var b=this.$class.reply.getPackage(c),e=0;b.versions.sort(function(a,b){return a.version<
b.version});this.pack=b;for(var d in b.versions){var f=b.versions[d];if(typeof f=="object"){f.version_u=f.getVersion().replace(/\./g,"_");if(e==0&&!this.version)this.version=f.version_u;e++}}},open:function(){var c=this;if(this.pack){this.$class.views.path(Settings.Core.templates+"package.ms").html(".package-info").args(this.pack).parse();$(".package-info").show();this.version!=null&&($("#info").hide(),$("a#v").each(function(){$(this).removeClass("active")}),$(".v"+this.version).show(),$("."+this.version).addClass("active"));
var a=this.pack.name;$("a#v").click(function(){var b=$(this).attr("version");c.$navigate("/package",a,b,!0)})}},close:function(){$(".package-info").hide()}}),View=Class.$extend({current:null,load:function(c){this.current&&this.unload();this.current=c;this.current.open()},unload:function(){this.current.close()}}),Pack=Class.$extend({__init__:function(c,a,b,e,d,f,h){this.name=c;this.website=a;this.categories=b;this.authors=e;this.maintainer=d;this.description=f;this.versions=h},getName:function(){return this.name},
getWebsite:function(){return this.website},getAuthors:function(){return this.authors},getMaintainer:function(){return this.maintainer},getDescription:function(){return this.description},getCategories:function(){return this.categories},getVersions:function(){return this.versions},getVersion:function(c){for(var a in this.versions)if(a.getVersion().equalsIgnoreCase(c))return a;return!1},getLatestVersion:function(){this.versions.sort(function(c,a){return c.version.compareTo(a.version)});return this.versions[0]},
getLatestBranchVersion:function(){}}),Version=Class.$extend({__init__:function(c,a,b,e,d,f){this.version=c;this.branch=a;this.checksum=b;this.url=e;this.required_dependencies=d.required;this.optional_dependencies=d.optional;this.conflicts=d.conflicts;this.engines=f},getVersion:function(){return this.version},getBranch:function(){return this.branch},getChecksum:function(){return this.checksum},getUrl:function(){return this.url},getDependencies:function(){return this.dependencies},getRequiredDependencies:function(){return this.dependencies.required},
getOptionalDependencies:function(){return this.dependencies.optional},hasEngine:function(c){if(isEmpty(this.engines))return!1;for(var a in this.engines)if(a.getName().equalsIgnoreCase(c))return!0;return!1},getEngine:function(c){if(isEmpty(this.engines))return!1;for(var a in this.engines)if(a.getName().equalsIgnoreCase(c))return a;return!1}}),Engine=Class.$extend({__init__:function(c,a,b){this.min=a;this.max=b;this.name=c},getName:function(){return this.name},getMin:function(){return this.min},getMax:function(){return this.min}}),
Packages=Class.$extend({__classvars__:{dict:{}},__init__:function(c){for(var a in c){var b=c[a],e=b.name;if(!e.isEmpty()){var d=b.website,f=b.authors,h=b.maintainer,i=b.description,o=b.categories,m=[],j;for(j in b.versions){var g=b.versions[j];if(!(typeof g!="object"||g===void 0)){var p=g.version,q=g.branch,r=g.checksum,s=g.location,t={conflicts:g.conflicts,required:g.required_dependencies,optional:g.optional_dependencies},n=[],k;for(k in g.engines){var l=g.engines[k];n[k]=new Engine(l.engine,l.build_min,
l.build_max)}m[j]=new Version(p,q,r,s,t,n)}}this.$class.dict[e]=new Pack(e,d,o,f,h,i,m)}}return this},exists:function(c){return this.$class.dict.contains(c)},getPackage:function(c){return this.$class.dict[c]},getPackages:function(){return this.__classvars__.dict}});$(function(){var c=new View;subscribe("/view",function(a){c.load(a?a:new Home)});var a=new Core;a.$class.pubsub||a.setView(new Home);(new Finder).check()});