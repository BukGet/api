var Settings={Core:{templates:"/static/templates/",runs:0,poll:60},Paging:{perPage:10}},Core=Class.$extend({__include__:[Settings.Core],__classvars__:{repo:"/repo.json",reply:"",json:"",polls:0,timer:null,views:null,pubsub:!1,runs:0,page:0},__init__:function(){var b=this;Settings.Core.runs<1&&(this.$route("/",function(){b.$class.page=0;b.setView(new Home);$(".s").keypress(function(a){if(a.which==13){var c=unescape($(this).val());c&&!c.isEmpty()&&b.$navigate("/search",c,!0);a.preventDefault();return!1}return!0})}),
this.$route("/page/:page",function(a){b.setView(new Home(a));$(".s").keypress(function(a){if(a.which==13){var d=unescape($(this).val());d&&!d.isEmpty()&&b.$navigate("/search",d,!0);a.preventDefault();return!1}return!0})}),this.$route("/search/:query",function(a){b.setView(new Search(a));$(".s").keypress(function(a){if(a.which==13){var d=unescape($(this).val());d&&!d.isEmpty()&&b.$navigate("/search",d,!0);a.preventDefault();return!1}return!0})}),this.$route("/search/:query/page/:page",function(a,c){b.setView(new Search(a,
c));$(".s").keypress(function(a){if(a.which==13){var c=unescape($(this).val());c&&!c.isEmpty()&&b.$navigate("/search",c,!0);a.preventDefault();return!1}return!0})}),this.$route("/category/:query",function(a){b.setView(new Organize(a));$(".s").keypress(function(a){if(a.which==13){var d=unescape($(this).val());d&&!d.isEmpty()&&b.$navigate("/search",d,!0);a.preventDefault();return!1}return!0})}),this.$route("/category/:query/page/:page",function(a,c){b.setView(new Organize(a,c));$(".s").keypress(function(a){if(a.which==
13){var c=unescape($(this).val());c&&!c.isEmpty()&&b.$navigate("/search",c,!0);a.preventDefault();return!1}return!0})}),this.$route("/package/:pack",function(a){b.setView(new Package(a))}),this.$route("/package/:pack/:version",function(a,c){b.setView(new Package(a,c))}));this.$class.views=new Template;this.pollRepo();if(Settings.Core.runs<1)this.$class.timer=(new Timer).interval(6E4),this.$class.timer.addCallback(this.pollRepo,this.poll),this.$class.timer.start(),Route.setup();Settings.Core.runs++},
register:function(b,a){this.$class[b]=a},setView:function(b){this.$class.pubsub=!0;publish("/view",[b])},pollRepo:function(){var b=this.$json(this.$class.repo);this.$class.reply=new Packages(b);this.$class.json={packages:b};this.$class.polls++}}),Finder=Core.$extend({__include__:[Settings.Paging],open:function(){},check:function(){this.$class.reply||alert("[Error] Reply from repo was empty.")}}),Organize=Core.$extend({__include__:[Settings.Paging],__init__:function(b,a){this.$super(this);this.query=
b;this.page=a===void 0?0:isNaN(a)?0:a;if(b){this.packs={};this.packs.packages=[];var c=this.packs.packages,d=0,e;for(e in this.$class.json.packages){var f=this.$class.json.packages[e];!e.equalsIgnoreCase("contains")&&this.ctag(f.categories,b)&&(c[d]=f,d++)}this.packs.packages=c}},open:function(){var b={},a=chunk(this.packs.packages,this.perPage);if(this.page<0)this.page=0;if(a.length-1<this.page)this.page=a.length-1;b.packages=a[this.page];b.chunks=a;b.chunkLength=a.length;b.page=this.page;b.path=
"#/category/"+this.query;this.$class.views.path(Settings.Core.templates+"packages.ms").html(".package-list").args(b).parse();$(".desc").each(function(){var a=$(this).text();a.length>80&&$(this).html(a.substring(0,80)+"...")});$(".package-list").show()},close:function(){$(".package-list").hide()},ctag:function(b,a){if(b.length<1)return!1;if(b.contains(a)||b.contains(a.toLowerCase()))return!0;for(var c=[],d=[],e="",f=0;f<b.length;f++){e=b[f].trim();e.equals("ADMIN")&&(e="ADMN");if(e.equalsIgnoreCase(a)||
e.equals(a))return!0;e.contains("/")?c=e.split("/"):e.contains("-")&&(c=e.split("-"));c.length<1&&(c=[e]);a.contains(",")&&(d=a.split(","));d.length<1&&(d=[a]);for(var g=0;g<d.length;g++){var i=d[g];if(e.equalsIgnoreCase(i)||e.equals(i))return!0;if(c.contains(i)||c.contains(i.toLowerCase()))return!0}}return!1}}),Search=Core.$extend({__include__:[Settings.Paging],__init__:function(b,a){this.$super(this);this.query=b;this.page=a===void 0?0:isNaN(a)?0:a;if(b){this.packs={};this.packs.packages=[];var c=
this.packs.packages,d=0,e;for(e in this.$class.json.packages)if(e!="contains"){var f=this.$class.json.packages[e],g=f.name,i=f.description,j=f.categories;if(g.equals(b)||g.equalsIgnoreCase(b)||g.search(RegExp(b,"gi"))!=-1||i.search(RegExp(b,"gi"))!=-1||this.ctag(j,b))c[d]=f,d++}this.packs.packages=c}},open:function(){var b={},a=chunk(this.packs.packages,this.perPage);if(this.page<0)this.page=0;if(a.length-1<this.page)this.page=a.length-1;b.packages=a[this.page];b.chunks=a;b.chunkLength=a.length;b.page=
this.page;b.path="#/search/"+this.query;this.$class.views.path(Settings.Core.templates+"packages.ms").html(".package-list").args(b).parse();$(".desc").each(function(){var a=$(this).text();a.length>80&&$(this).html(a.substring(0,80)+"...")});$(".package-list").show()},close:function(){$(".package-list").hide()},ctag:function(b,a){if(b.length<1)return!1;if(b.contains(a))return!0;if(b.contains(a.toLowerCase()))return!0;for(var c=[],c="",d=0;d<b.length;d++){c=b[d];c.trim();c.equals("ADMIN")&&(c="ADMN");
if(c.equalsIgnoreCase(a)||c.equals(a))return!0;if(c.contains("/")){if(c=c.split("/"),c.contains(a)||c.contains(a.toLowerCase()))return!0}else if(c.contains("-")){if(c=c.split("-"),c.contains(a)||c.contains(a.toLowerCase()))return!0}else if(c.contains(" ")&&(c=c.split(" "),c.contains(a)||c.contains(a.toLowerCase())))return!0}return!1}}),Home=Core.$extend({__include__:[Settings.Paging],__init__:function(b){this.$super(this);this.page=b===void 0?0:isNaN(b)?0:b},open:function(){var b={},a=chunk(this.$class.json.packages,
this.perPage);if(this.page<0)this.page=0;if(a.length-1<this.page)this.page=a.length-1;b.packages=a[this.page];b.chunks=a;b.chunkLength=a.length;b.page=this.page;b.path="#/";this.$class.views.path(Settings.Core.templates+"packages.ms").html(".package-list").args(b).parse();$(".desc").each(function(){var a=$(this).text();a.length>80&&$(this).html(a.substring(0,80)+"...")});$(".package-list").show()},close:function(){$(".package-list").hide()}}),Package=Core.$extend({__init__:function(b,a){this.$super(this);
if(a)this.version=a.replace(/\./g,"_");var c=this.$class.reply.getPackage(b),d=0;c.versions.sort(function(a,b){return a.version<b.version});this.pack=c;for(var e in c.versions){var f=c.versions[e];if(typeof f=="object"){f.version_u=f.getVersion().replace(/\./g,"_");if(d==0&&!this.version)this.version=f.version_u;d++}}},open:function(){var b=this;if(this.pack){this.$class.views.path(Settings.Core.templates+"package.ms").html(".package-info").args(this.pack).parse();$(".package-info").show();this.version!=
null&&($("#info").hide(),$("a#v").each(function(){$(this).removeClass("active")}),$(".v"+this.version).show(),$("."+this.version).addClass("active"));var a=this.pack.name;$("a#v").click(function(){var c=$(this).attr("version");b.$navigate("/package",a,c,!0)})}},close:function(){$(".package-info").hide()}}),View=Class.$extend({current:null,load:function(b){this.current&&this.unload();this.current=b;this.current.open()},unload:function(){this.current.close()}}),Pack=Class.$extend({__init__:function(b,
a,c,d,e,f,g){this.name=b;this.website=a;this.categories=c;this.authors=d;this.maintainer=e;this.description=f;this.versions=g},getName:function(){return this.name},getWebsite:function(){return this.website},getAuthors:function(){return this.authors},getMaintainer:function(){return this.maintainer},getDescription:function(){return this.description},getCategories:function(){return this.categories},getVersions:function(){return this.versions},getVersion:function(b){for(var a in this.versions)if(a.getVersion().equalsIgnoreCase(b))return a;
return!1},getLatestVersion:function(){this.versions.sort(function(b,a){return b.version.compareTo(a.version)});return this.versions[0]},getLatestBranchVersion:function(){}}),Version=Class.$extend({__init__:function(b,a,c,d,e,f){this.version=b;this.branch=a;this.checksum=c;this.url=d;this.required_dependencies=e.required;this.optional_dependencies=e.optional;this.conflicts=e.conflicts;this.engines=f},getVersion:function(){return this.version},getBranch:function(){return this.branch},getChecksum:function(){return this.checksum},
getUrl:function(){return this.url},getDependencies:function(){return this.dependencies},getRequiredDependencies:function(){return this.dependencies.required},getOptionalDependencies:function(){return this.dependencies.optional},hasEngine:function(b){if(isEmpty(this.engines))return!1;for(var a in this.engines)if(a.getName().equalsIgnoreCase(b))return!0;return!1},getEngine:function(b){if(isEmpty(this.engines))return!1;for(var a in this.engines)if(a.getName().equalsIgnoreCase(b))return a;return!1}}),
Engine=Class.$extend({__init__:function(b,a,c){this.min=a;this.max=c;this.name=b},getName:function(){return this.name},getMin:function(){return this.min},getMax:function(){return this.min}}),Packages=Class.$extend({__classvars__:{dict:{}},__init__:function(b){for(var a in b){var c=b[a],d=c.name;if(!d.isEmpty()){var e=c.website,f=c.authors,g=c.maintainer,i=c.description,j=c.categories,n=[],k;for(k in c.versions){var h=c.versions[k];if(!(typeof h!="object"||h===void 0)){var p=h.version,q=h.branch,r=
h.checksum,s=h.location,t={conflicts:h.conflicts,required:h.required_dependencies,optional:h.optional_dependencies},o=[],l;for(l in h.engines){var m=h.engines[l];o[l]=new Engine(m.engine,m.build_min,m.build_max)}n[k]=new Version(p,q,r,s,t,o)}}this.$class.dict[d]=new Pack(d,e,j,f,g,i,n)}}return this},exists:function(b){return this.$class.dict.contains(b)},getPackage:function(b){return this.$class.dict[b]},getPackages:function(){return this.__classvars__.dict}});
$(function(){var b=new View;subscribe("/view",function(a){b.load(a?a:new Home)});var a=new Core;a.$class.pubsub||a.setView(new Home);(new Finder).check()});