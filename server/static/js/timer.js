var Timer=Class.$extend({Settings:{timer:null,running:!1,runOnce:!1,canRun:[],interval:500,callbacks:[],multipliers:[],ticks:[],completed:0,paused:-1,started:-1},__init__:function(a,b){this.Settings.interval=parseInt(a);this.addCallback(b);return this},runnable:function(a){if(typeof a=="boolean")this.Settings.runOnce=a;return this},interval:function(a){if(typeof a=="number")this.Settings.interval=Math.floor(a);return this},addCallback:function(a,b){typeof a=="function"&&(this.Settings.callbacks.push(a),
typeof b=="number"?(b=Math.floor(b),this.Settings.multipliers.push(b<1?1:b)):this.Settings.multipliers.push(1),this.Settings.ticks.push(0),this.Settings.canRun.push(!0));return this},pulse:function(a){for(var b=0;b<this.Settings.callbacks.length;b++)typeof this.Settings.callbacks[b]=="function"&&this.Settings.canRun[b]&&(this.Settings.ticks[b]++,this.Settings.ticks[b]==this.Settings.multipliers[b]&&(this.Settings.ticks[b]=0,this.Settings.runOnce&&(this.Settings.canRun[b]=!1,this.Settings.completed++),
window.setTimeout(this.Settings.callbacks[b],0)));this.Settings.runOnce&&this.Settings.completed==this.Settings.callbacks.length&&this.stop();typeof a=="number"&&this.stop().start(null,!0)},reset:function(){this.Settings.completed=0;this.Settings.started=-1;this.Settings.paused=-1;for(var a=0;a<this.Settings.callbacks.length;a++)this.Settings.canRun[a]=!0,this.Settings.ticks[a]=0},start:function(a,b){if(this.paused())return this.resume();if(!this.stopped())return this;b||this.reset();var c=this.Settings.interval;
typeof a=="number"&&(c=a);var d=this;this.Settings.timer=window.setInterval(function(){d.pulse(a)},c);this.Settings.started=(new Date).getTime();this.Settings.started-=this.Settings.interval-c;return this},restart:function(){return this.stop().start()},pause:function(){if(this.Settings.timer)this.Settings.paused=(new Date).getTime(),this.stop(!0);return this},stop:function(a){if(this.Settings.timer){if(!a)this.Settings.paused=-1;try{window.clearInterval(this.Settings.timer)}catch(b){}this.Settings.timer=
null}return this},stopped:function(){return this.Settings.timer==null&&!this.paused()},paused:function(){return this.Settings.paused>=0},clear:function(){this.Settings.callbacks.length=0;this.Settings.multipliers.length=0;this.Settings.canRun.length=0;this.Settings.ticks.length=0;this.Settings.completed=0;return this}});